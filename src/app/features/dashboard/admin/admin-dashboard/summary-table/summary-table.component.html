<!-- summary-table.component.html -->
<div class="summary-table">
  <div class="table-header">
    <h2>Récapitulatif par Classe</h2>
    <div class="summary-stats" *ngIf="!loading && !error">
      <div class="stat-item">
        <span class="stat-label">Total Effectif:</span>
        <span class="stat-value">{{ getTotalEffectif() }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Capacité Totale:</span>
        <span class="stat-value">{{ getTotalCapacite() }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Taux Moyen:</span>
        <span class="stat-value" [ngClass]="getTauxRemplissageClass(getMoyenneTauxRemplissage())">
          {{ getMoyenneTauxRemplissage() }}%
        </span>
      </div>
    </div>
  </div>

  <div *ngIf="loading" class="loading-state">
    <i class="pi pi-spin pi-spinner"></i>
    <p>Chargement du récapitulatif...</p>
  </div>

  <div *ngIf="error" class="error-state">
    <i class="pi pi-exclamation-triangle"></i>
    <p>Erreur lors du chargement des données</p>
    <button (click)="loadSummaryData()" class="retry-btn">Réessayer</button>
  </div>

  <div *ngIf="!loading && !error" class="table-container">
    <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z4">

      <!-- Nom de classe Column -->
      <ng-container matColumnDef="nom">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Classe </th>
        <td mat-cell *matCellDef="let element">
          <div class="classe-name">{{ element.nom }}</div>
        </td>
      </ng-container>

      <!-- Niveau Column -->
      <ng-container matColumnDef="niveau">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Niveau </th>
        <td mat-cell *matCellDef="let element">
          <span class="niveau-badge">{{ element.niveau }}</span>
        </td>
      </ng-container>

      <!-- Effectif Column -->
      <ng-container matColumnDef="effectif">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Effectif </th>
        <td mat-cell *matCellDef="let element">
          <div class="effectif-cell">
            <span class="effectif-number">{{ element.effectif }}</span>
            <i class="pi pi-users"></i>
          </div>
        </td>
      </ng-container>

      <!-- Capacité Column -->
      <ng-container matColumnDef="capacite">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Capacité </th>
        <td mat-cell *matCellDef="let element">
          <span class="capacite-number">{{ element.capacite }}</span>
        </td>
      </ng-container>

      <!-- Taux de remplissage Column -->
      <ng-container matColumnDef="tauxRemplissage">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Taux de Remplissage </th>
        <td mat-cell *matCellDef="let element">
          <div class="taux-container">
            <div class="taux-bar">
              <div class="taux-fill"
                   [style.width.%]="element.tauxRemplissage"
                   [ngClass]="getTauxRemplissageClass(element.tauxRemplissage)">
              </div>
            </div>
            <span class="taux-percentage"
                  [ngClass]="getTauxRemplissageClass(element.tauxRemplissage)">
              {{ element.tauxRemplissage }}%
            </span>
          </div>
        </td>
      </ng-container>

      <!-- Nombre de modules Column -->
      <ng-container matColumnDef="nombreModules">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Modules </th>
        <td mat-cell *matCellDef="let element">
          <span class="modules-count">{{ element.nombreModules }}</span>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <!-- Row shown when no matching data is found -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell no-data-cell" [attr.colspan]="displayedColumns.length">
          <div class="no-data-message">
            <i class="pi pi-info-circle"></i>
            <span>Aucune classe trouvée</span>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>
